---
shortcuts:
  - type: DetailBuffer
    name: inventario
    id: codInventario
    schemaName: inventarios
  - type: Model
    name: lineas
    id: idLinea
    schema: lineasInventario
state:
  vistaDetalle: principal
  todasLasLineas: false
  filtroLineasVisible: false
bunch:
  onInit:
    - condition:
        operator: A is defined
        A:
          statePath: inventario.data.codInventario
      _type: grape
      name: getLineas
  onInventarioBufferSectionAccepted:
    - _type: grape
      name: saveInventario
  onInventarioBufferSectionCancelled:
    - _type: grape
      name: loadBufferInventario
  onLineasItemChanged:
    - _type: grape
      name: reloadInventario
  onLineaCreada:
    - _type: grape
      name: reloadInventario
    - _type: grape
      name: addLineasItem
  onAtrasClicked:
    - _type: grape
      name: cancelInventario
  onMasClicked:
    - _type: if
      if:
        operator: A = B
        A:
          statePath: vistaDetalle
        B:
          const: principal
      then:
        _type: set
        path: vistaDetalle
        value:
          const: otra
      else:
        _type: set
        path: vistaDetalle
        value:
          const: principal
  # onCambiaEstadoConfirmado:            
  #   - _type: grape
  #     name: onInventarioBufferChanged 
  #     payload:
  #       field:
  #         const: "estado"   
  #       value:
  #         code: 'return state.inventario.buffer.estado === "Abierto" ? "Cerrado" : "Abierto"'
  #   - _type: grape
  #     name: saveInventario  
  onCerrarAbrirInventarioConfirmado:
    - _type: patch
      action: cerrarAbrirInventario
      schema: inventarios
      id:
        payloadPath: codInventario
      success: onCerrarAbrirInventarioSuccess
  onCerrarAbrirInventarioSuccess:
    - _type: grape
      name: reloadInventario
  onVerTodoClicked:  
    - _type: set
      path: todasLasLineas
      value:
        toggleStatePath: todasLasLineas      
  onMostrarFiltroLineasClicked:
    - _type: set
      path: filtroLineasVisible
      value:
        toggleStatePath: filtroLineasVisible   
  onLineasFilterChanged: 
    - _type: grape
      name: onMostrarFiltroLineasClicked
    - _type: set
      path: lineas.filter
      value:
        payloadPath: value
    - _type: grape
      name: getLineas            
  onCerrarLineaClicked:
    - _type: patch
      action: cerrar_linea
      schema: lineasInventario
      id:
        payloadPath: idLinea
      success: onCerrarLineaSuccess
  # onCerrarLineaSuccess:
  #   - _type: grape
  #     name: getLineas
  onCantidadLineaBlurr:
    - _type: grape
      name: onCantidadLineaCambiada 
  onCantidadLineaCambiada:
    - _type: patch
      action: cambiarCantidadLinea
      schema: lineasInventario
      id:
        payloadPath: idLinea
      data:
        - key: cantidadfin
          value:
            payloadPath: nuevaCantidadLinea
      success: onCerrarLineaSuccess